schema: '2.0'
stages:
  import_raw_data:
    cmd: python src/ml/data/import_raw_data.py
    deps:
    - path: 
        data/raw/comptage-velo-donnees-compteurs-2024-2025_Enriched_ML-ready_data.csv
      hash: md5
      md5: e38aee22570ad4ab0b92d72dba3690cf
      size: 149464819
    - path: src/ml/data/data_utils.py
      hash: md5
      md5: 74fb0b7c34f2dfb7c6aae9fd2ca5551b
      size: 896
    - path: src/ml/data/import_raw_data.py
      hash: md5
      md5: 2099b1a12b7beda882d02c6e01e0bfb0
      size: 3385
    - path: src/test_config.py
      hash: md5
      md5: 8aaec5344572ee37b070b7d72fe333c7
      size: 1943
    outs:
    - path: data/interim/Sebastopol_N-S_v2/
      hash: md5
      md5: a63a37b43985a1ca9d5d06681ca9ac23.dir
      size: 1216943
      nfiles: 1
  build_features:
    cmd: python src/ml/features/build_features.py
    deps:
    - path: data/interim/Sebastopol_N-S_v2/
      hash: md5
      md5: a63a37b43985a1ca9d5d06681ca9ac23.dir
      size: 1216943
      nfiles: 1
    - path: src/ml/features/build_features.py
      hash: md5
      md5: 24d6485925da48801e93a9be36b4417c
      size: 3435
    - path: src/ml/features/features_utils.py
      hash: md5
      md5: 7325746a0934d801f392e0f0574d1f67
      size: 3776
    outs:
    - path: data/processed/Sebastopol_N-S_v2/
      hash: md5
      md5: 4d9ab96b3c2d455d51e270e02d34576e.dir
      size: 1350050
      nfiles: 1
  train_and_predict:
    cmd: python src/ml/models/train_and_predict.py
    deps:
    - path: data/processed/Sebastopol_N-S_v2/
      hash: md5
      md5: 4d9ab96b3c2d455d51e270e02d34576e.dir
      size: 1350050
      nfiles: 1
    - path: src/ml/models/mlflow_tracking.py
      hash: md5
      md5: 665e358bb0c1066f8c0c7f4585c32c18
      size: 4308
    - path: src/ml/models/models_utils.py
      hash: md5
      md5: 86bf7ee7f34237d8ad4c0e616813f1b5
      size: 20091
    - path: src/ml/models/train_and_predict.py
      hash: md5
      md5: 6c01ea9309a0f3acda90112844f931b7
      size: 4642
    outs:
    - path: data/final/Sebastopol_N-S_v2/
      hash: md5
      md5: 5dae20614df0af0c108d32a05e79307c.dir
      size: 2400660
      nfiles: 9
    - path: models/Sebastopol_N-S_v2/
      hash: md5
      md5: 5451b1309fb2440f48aa8b26b1b73083.dir
      size: 419054
      nfiles: 4
  import_raw_data@sebastopol_ns_v3:
    cmd: "python -m src.ml.data.import_raw_data --raw-path data/raw/comptage-velo-donnees-compteurs-2024-2025_Enriched_ML-ready_data.csv
      --site \"Totem 73 boulevard de Sébastopol\" --orientation \"N-S\" --range-start
      0.0 --range-end 75.0 --sub-dir Sebastopol_N-S_dvcrepro --interim-name initial.csv\n"
    deps:
    - path: 
        data/raw/comptage-velo-donnees-compteurs-2024-2025_Enriched_ML-ready_data.csv
      hash: md5
      md5: e38aee22570ad4ab0b92d72dba3690cf
      size: 149464819
    - path: src/ml/data/data_utils.py
      hash: md5
      md5: 5d830030c3197301d808144481181608
      size: 963
    - path: src/ml/data/import_raw_data.py
      hash: md5
      md5: f0b53169591c51f20efb783d59e707ae
      size: 4845
    params:
      params.yaml:
        data.raw_csv: 
          data/raw/comptage-velo-donnees-compteurs-2024-2025_Enriched_ML-ready_data.csv
        scenarios.sebastopol_ns_v3:
          site: Totem 73 boulevard de Sébastopol
          orientation: N-S
          range_start: 0.0
          range_end: 75.0
          subdir: Sebastopol_N-S_dvcrepro
    outs:
    - path: data/interim/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: a63a37b43985a1ca9d5d06681ca9ac23.dir
      size: 1216943
      nfiles: 1
  build_features@sebastopol_ns_v3:
    cmd: "python -m src.ml.features.build_features --interim-path data/interim/Sebastopol_N-S_dvcrepro/initial.csv
      --sub-dir Sebastopol_N-S_dvcrepro --processed-name initial_with_feats.csv\n"
    deps:
    - path: data/interim/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: a63a37b43985a1ca9d5d06681ca9ac23.dir
      size: 1216943
      nfiles: 1
    - path: src/ml/features/build_features.py
      hash: md5
      md5: 48e40b7a150b9618643afd74c5a927de
      size: 4161
    - path: src/ml/features/features_utils.py
      hash: md5
      md5: dcd8f42d3b6488f41db8a3057cd4147a
      size: 3851
    params:
      params.yaml:
        files.processed: initial_with_feats.csv
    outs:
    - path: data/processed/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: 4d9ab96b3c2d455d51e270e02d34576e.dir
      size: 1350050
      nfiles: 1
  train_and_predict@sebastopol_ns_v3:
    cmd: "python -m src.ml.models.train_and_predict --processed-path data/processed/Sebastopol_N-S_dvcrepro/initial_with_feats.csv
      --sub-dir Sebastopol_N-S_dvcrepro --target-col comptage_horaire --ts-col-utc
      date_et_heure_de_comptage_utc --ts-col-local date_et_heure_de_comptage_local
      --ar 7 --mm 1 --roll 24 --test-ratio 0.25 --grid-iter 0\n"
    deps:
    - path: data/processed/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: 4d9ab96b3c2d455d51e270e02d34576e.dir
      size: 1350050
      nfiles: 1
    - path: src/ml/models/mlflow_tracking.py
      hash: md5
      md5: 1f546c4260492995302e2805070df906
      size: 5226
    - path: src/ml/models/models_utils.py
      hash: md5
      md5: e6e8379e50bc446a6077bfdb6b76a84d
      size: 20219
    - path: src/ml/models/train_and_predict.py
      hash: md5
      md5: fbf176dfa1b6a72f7df8dc3a66081378
      size: 5679
    params:
      params.yaml:
        train:
          target_col: comptage_horaire
          ts_col_utc: date_et_heure_de_comptage_utc
          ts_col_local: date_et_heure_de_comptage_local
          ar: 7
          mm: 1
          roll: 24
          test_ratio: 0.25
          grid_iter: 0
    outs:
    - path: data/final/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: 5dae20614df0af0c108d32a05e79307c.dir
      size: 2400660
      nfiles: 9
    - path: models/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: e57a649816798c65bcca73c7e8e4cdc2.dir
      size: 419068
      nfiles: 4
  import_raw_data@sebastopol_ns:
    cmd: "python -m src.ml.ingest.import_raw_data --raw-path data/raw/comptage-velo-donnees-compteurs-2024-2025_Enriched_ML-ready_data.csv
      --site \"Totem 73 boulevard de Sébastopol\" --orientation \"N-S\" --range-start
      0.0 --range-end 75.0 --sub-dir Sebastopol_N-S_dvcrepro --interim-name initial.csv\n"
    deps:
    - path: 
        data/raw/comptage-velo-donnees-compteurs-2024-2025_Enriched_ML-ready_data.csv
      hash: md5
      md5: e38aee22570ad4ab0b92d72dba3690cf
      size: 149464819
    - path: src/ml/ingest/import_raw_data.py
      hash: md5
      md5: 8171175cdf79b241ec8c20b222d4fa70
      size: 7555
    - path: src/ml/ingest/ingest_utils.py
      hash: md5
      md5: 5701677a091e0650ed4a5de9622e5e72
      size: 3361
    params:
      params.yaml:
        data.raw_csv: 
          data/raw/comptage-velo-donnees-compteurs-2024-2025_Enriched_ML-ready_data.csv
        scenarios.sebastopol_ns:
          site: Totem 73 boulevard de Sébastopol
          orientation: N-S
          range_start: 0.0
          range_end: 75.0
          subdir: Sebastopol_N-S_dvcrepro
    outs:
    - path: data/interim/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: d876f3ac2b45c9a71ab7606e03b60f76.dir
      size: 1209567
      nfiles: 1
  build_features@sebastopol_ns:
    cmd: "python -m src.ml.features.build_features --interim-path data/interim/Sebastopol_N-S_dvcrepro/initial.csv
      --sub-dir Sebastopol_N-S_dvcrepro --processed-name initial_with_feats.csv\n"
    deps:
    - path: data/interim/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: d876f3ac2b45c9a71ab7606e03b60f76.dir
      size: 1209567
      nfiles: 1
    - path: src/ml/features/build_features.py
      hash: md5
      md5: b95507e8466400a2fbafd3eafdc785fd
      size: 6369
    - path: src/ml/features/features_utils.py
      hash: md5
      md5: 827e4300716bf56b8903cf0a4146e6ab
      size: 6157
    params:
      params.yaml:
        files.processed: initial_with_feats.csv
    outs:
    - path: data/processed/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: 129fe5f282cc36321a94d8877385d330.dir
      size: 1342674
      nfiles: 1
  train_and_predict@sebastopol_ns:
    cmd: "python -m src.ml.models.train_and_predict --processed-path data/processed/Sebastopol_N-S_dvcrepro/initial_with_feats.csv
      --sub-dir Sebastopol_N-S_dvcrepro --target-col comptage_horaire --ts-col-utc
      date_et_heure_de_comptage_utc --ts-col-local date_et_heure_de_comptage_local
      --ar 7 --mm 1 --roll 24 --test-ratio 0.25 --grid-iter 0\n"
    deps:
    - path: data/processed/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: 129fe5f282cc36321a94d8877385d330.dir
      size: 1342674
      nfiles: 1
    - path: src/ml/models/mlflow_tracking.py
      hash: md5
      md5: 36c05ce5f931cb315cc28df6e9cc1627
      size: 5062
    - path: src/ml/models/models_utils.py
      hash: md5
      md5: 837a892b4e68f0328b5d258dda9c28b4
      size: 23369
    - path: src/ml/models/train_and_predict.py
      hash: md5
      md5: b47c173bcc3169abea58f5d1fa31296d
      size: 11154
    params:
      params.yaml:
        train:
          target_col: comptage_horaire
          ts_col_utc: date_et_heure_de_comptage_utc
          ts_col_local: date_et_heure_de_comptage_local
          ar: 7
          mm: 1
          roll: 24
          test_ratio: 0.25
          grid_iter: 0
    outs:
    - path: data/final/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: 0ecb76c1f1016ed88b893750f7628e41.dir
      size: 2363896
      nfiles: 9
    - path: models/Sebastopol_N-S_dvcrepro
      hash: md5
      md5: 03b3e5392e38048aa01ba7136de7dc6a.dir
      size: 418993
      nfiles: 4
